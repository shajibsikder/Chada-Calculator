
      let chadaChartInstance = null;

      const icons = {
        survival: {
          crying: `<div class="text-6xl">ЁЯШн</div>`,
          sad: `<div class="text-6xl">ЁЯШФ</div>`,
          neutral: `<div class="text-6xl">ЁЯШР</div>`,
          happy: `<div class="text-6xl">ЁЯШК</div>`,
        },
        leaderMood: {
          angry: `<div class="text-6xl">ЁЯШб</div>`,
          thinking: `<div class="text-6xl">ЁЯдФ</div>`,
          happy: `<div class="text-6xl">ЁЯШД</div>`,
          strong: `<div class="text-6xl">ЁЯТк</div>`,
          trophy: `<div class="text-6xl">ЁЯПЖ</div>`,
        },
        contribution: {
          tea: `<div class="text-6xl">тШХ</div>`,
          rock: `<div class="text-6xl">ЁЯз▒</div>`,
          plane: `<div class="text-6xl">тЬИя╕П</div>`,
          building: `<div class="text-6xl">ЁЯПЫя╕П</div>`,
        },
      };

      function formatCurrency(amount) {
        return `рз│ ${amount.toLocaleString("bn-BD", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        })}`;
      }

      function getLeadersMood(monthlyChada) {
        if (monthlyChada < 2000)
          return { icon: icons.leaderMood.angry, text: "ржЪрзЗржпрж╝рж╛рж░ржорзНржпрж╛ржи рж╣рждрж╛рж╢!" };
        if (monthlyChada < 10000)
          return {
            icon: icons.leaderMood.thinking,
            text: "рж▓ржирзНржбржи ржерзЗржХрзЗ ржмрж╛рж░рзНрждрж╛ ржЖрж╕ржмрзЗ...",
          };
        if (monthlyChada < 50000)
          return { icon: icons.leaderMood.happy, text: "ржжрзЗрж╢ржирзЗрждрзНрж░рзА ржЦрзБрж╢рж┐ рж╣ржмрзЗржи!" };
        if (monthlyChada < 100000)
          return { icon: icons.leaderMood.strong, text: "ржЬрж┐ржпрж╝рж╛рж░ рж╕рзИржирж┐ржХ рж╕ржлрж▓!" };
        return { icon: icons.leaderMood.trophy, text: "рж╕рж░рж╛рж╕рж░рж┐ ржиржорж┐ржирзЗрж╢ржи!" };
      }

      function getContributionUse(monthlyChada) {
        if (monthlyChada < 2000)
          return { icon: icons.contribution.tea, text: "ржирзЗрждрж╛рж░ ржПржХ ржХрж╛ржк ржЪрж╛" };
        if (monthlyChada < 10000)
          return {
            icon: icons.contribution.rock,
            text: "рж╣рж░рждрж╛рж▓рзЗрж░ ржЬржирзНржп ржЗржЯ-ржкрж╛ржЯржХрзЗрж▓",
          };
        if (monthlyChada < 50000)
          return { icon: icons.contribution.plane, text: "рж▓ржирзНржбржи рж╕ржлрж░рзЗрж░ ржПржХрж╛ржВрж╢" };
        return {
          icon: icons.contribution.building,
          text: "ржиржорж┐ржирзЗрж╢ржирзЗрж░ ржбрж╛ржЙржи ржкрзЗржорзЗржирзНржЯ",
        };
      }

      function getHumorText(profession) {
        switch (profession) {
          case "doctor":
            return "ржбрж╛ржХрзНрждрж╛рж░ рж╕рж╛рж╣рзЗржм, ржжрзЗрж╢ржирзЗрждрзНрж░рзАрж░ ржЪрж┐ржХрж┐рзОрж╕рж╛рж░ ржЬржирзНржп ржЖржкржирж╛рж░ ржЕржмржжрж╛ржи ржЦрзБржмржЗ ржЬрж░рзБрж░рж┐!";
          case "engineer":
            return "ржЗржЮрзНржЬрж┐ржирж┐ржпрж╝рж╛рж░ рж╕рж╛рж╣рзЗржм, ржирждрзБржи ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ ржЧржбрж╝рждрзЗ ржЖржкржирж╛рж░ ржкржХрзЗржЯрзЗрж░ ржЕржмржжрж╛ржиржУ рж▓рж╛ржЧржмрзЗ!";
          case "teacher":
            return "рж╢рж┐ржХрзНрж╖ржХ ржорж╛ржирзБрж╖, ржЖржкржирж╛рж░ ржжрзЛржпрж╝рж╛ржЯрж╛ржЗ ржмржбрж╝ ржХржерж╛ред рждржмрзЗ ржжрзЛржпрж╝рж╛рж░ рж╕рж╛ржерзЗ 'ржжрж╛ржи' рж╣рж▓рзЗ ржЧржгрждржирзНрждрзНрж░ ржорзБржХрзНрждрж┐ ржкрж╛ржмрзЗред";
          case "govt_job":
            return "рж╕рж░ржХрж╛рж░рзА ржЪрж╛ржХрзБрж░рзАржЬрзАржмрзА? ржнржпрж╝ ржкрж╛ржмрзЗржи ржирж╛, рж╕рж░ржХрж╛рж░ ржмржжрж▓рж╛рж▓рзЗ ржЖржкржирж┐ржЗ рждрзЛ ржЖржорж╛ржжрзЗрж░ рж▓рзЛржХ!";
          case "businessman":
            return "ржмрзНржпржмрж╕рж╛ржпрж╝рзА ржнрж╛ржЗ, рж╢рж╣рзАржж ржЬрж┐ржпрж╝рж╛рж░ ржЖржжрж░рзНрж╢ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржирзЗ ржЖржкржирж╛рж░ ржмрж┐ржирж┐ржпрж╝рзЛржЧ ржЖржмрж╢рзНржпржХ!";
          case "freelancer":
            return "ржлрзНрж░рж┐рж▓рзНржпрж╛ржирзНрж╕рж╛рж░ ржнрж╛ржЗ, рж▓ржирзНржбржирзЗ ржирзЗрждрж╛рж░ ржХрж╛ржЫрзЗ ржЖржкржирж╛рж░ ржбрж▓рж╛рж░рзЗрж░ ржЦрзБржм ржжрж░ржХрж╛рж░!";
          case "rickshaw_puller":
            return "рж░рж┐ржХрж╢рж╛ржУржпрж╝рж╛рж▓рж╛ ржнрж╛ржЗ, ржЖржкржирж╛рж░ ржнрж╛ржбрж╝рж╛рж░ ржЯрж╛ржХрж╛ ржжрж┐ржпрж╝рзЗ ржирзЗрждрж╛рж░ ржЧрж╛ржбрж╝рж┐рж░ ржкрзЗржЯрзНрж░рзЛрж▓! ржХрзА ржЪржорзОржХрж╛рж░ ржмрзНржпрж╛ржкрж╛рж░!";
          case "day_laborer":
            return "ржжрж┐ржиржоржЬрзБрж░ ржнрж╛ржЗ, ржЖржкржирж╛рж░ рж╣рж╛ржбрж╝ржнрж╛ржЩрж╛ ржЦрж╛ржЯрзБржирж┐рж░ ржЯрж╛ржХрж╛ ржжрж┐ржпрж╝рзЗ ржирзЗрждрж╛рж░ ржмрж┐ржжрзЗрж╢ рж╕ржлрж░! ржжрзЗрж╢ржкрзНрж░рзЗржорзЗрж░ ржиржорзБржирж╛!";
          case "unemployed":
            return "ржмрзЗржХрж╛рж░ ржнрж╛ржЗ, ржХрж╛ржЬ ржирзЗржЗ ржХрж┐ржирзНрждрзБ ржЪрж╛ржБржжрж╛ ржжрж┐рждрзЗ рж╣ржмрзЗ! ржПржЯрж╛ржЗ рждрзЛ ржЖржорж╛ржжрзЗрж░ ржкрж╛рж░рзНржЯрж┐рж░ ржирж┐ржпрж╝ржо!";
          case "expatriate_worker":
            return "ржкрзНрж░ржмрж╛рж╕рзА ржнрж╛ржЗ, ржЖржкржирж╛рж░ рж░рзЗржорж┐ржЯрзНржпрж╛ржирзНрж╕ржЗ ржжрзЗрж╢рзЗрж░ ржорзЗрж░рзБржжржгрзНржб! рж╕рзЗржЗ ржорзЗрж░рзБржжржгрзНржб ржирзЗрждрж╛рж░ ржкржХрзЗржЯрзЗ!";
          default:
            return "ржЖржкржирж╛рж░ ржЯрж╛ржХрж╛ржпрж╝ ржХрзЗржирж╛ ржкрзЗржЯрзНрж░рзЛрж▓ ржЧржгрждржирзНрждрзНрж░рзЗрж░ ржорж╢рж╛рж▓ ржЬрзНржмрж╛рж▓рж╛ржмрзЗ!";
        }
      }

      function getSurvivalAnalysis(remainingSalary) {
        if (remainingSalary < 15000)
          return {
            icon: icons.survival.crying,
            text: "ржПржЗ ржЯрж╛ржХрж╛ржпрж╝ ржорж╛рж╕ ржЪрж▓ржмрзЗ? ржЖржирзНржжрзЛрж▓ржи ржХрж░рж╛рж░ рж╢ржХрзНрждрж┐ржУ рждрзЛ ржерж╛ржХржмрзЗ ржирж╛!",
          };
        if (remainingSalary < 25000)
          return {
            icon: icons.survival.sad,
            text: "ржбрж╛рж▓-ржнрж╛ржд ржЦрзЗржпрж╝рзЗ ржЧржгрждржирзНрждрзНрж░ рж░ржХрзНрж╖рж╛ ржХрж░рждрзЗ рж╣ржмрзЗ!",
          };
        if (remainingSalary < 50000)
          return {
            icon: icons.survival.neutral,
            text: "ржЖржкржирж┐ ржЯрж┐ржХрзЗ ржпрж╛ржмрзЗржи, ржжрж▓рзЗрж░ ржЬржирзНржпржУ ржХрж┐ржЫрзБ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред",
          };
        return {
          icon: icons.survival.happy,
          text: "ржЖржкржирж┐ рждрзЛ ржмрзЗрж╢ ржнрж╛рж▓рзЛржЗ ржерж╛ржХржмрзЗржи! ржжрж▓рзЗрж░ ржЬржирзНржп ржЖрж░ржУ ржнрж╛ржмрзБржи!",
        };
      }

      function calculateChada() {
        const profession = document.getElementById("profession").value;
        const salaryInput = document.getElementById("salary");
        const salary = parseFloat(salaryInput.value);

        const resultContainer = document.getElementById("result-container");
        const genzResultContainer = document.getElementById(
          "genz-result-container"
        );
        const awamiResultContainer = document.getElementById(
          "awami-result-container"
        );
        const errorMessage = document.getElementById("error-message");

        // Hide all containers initially
        resultContainer.classList.add("hidden");
        genzResultContainer.classList.add("hidden");
        awamiResultContainer.classList.add("hidden");
        errorMessage.classList.add("hidden");

        // --- Special Profession Handling ---
        if (profession === "genz") {
          genzResultContainer.classList.remove("hidden");
          genzResultContainer.scrollIntoView({ behavior: "smooth" });
          return;
        }

        if (profession === "retired_awami") {
          awamiResultContainer.classList.remove("hidden");
          awamiResultContainer.scrollIntoView({ behavior: "smooth" });
          return;
        }

        // --- Regular Calculation Validation ---
        if (profession === "default" && (isNaN(salary) || salary <= 0)) {
          errorMessage.innerText =
            "ржмрж┐ржкрзНрж▓ржмрзА, ржЖржкржирж╛рж░ ржкрзЗрж╢рж╛ ржПржмржВ ржЖржпрж╝рзЗрж░ ржкрж░рж┐ржорж╛ржг ржарж┐ржХржарж╛ржХ ржжрж┐ржи!";
          errorMessage.classList.remove("hidden");
          return;
        }

        if (profession === "default") {
          errorMessage.innerText = "ржмрж┐ржкрзНрж▓ржмрзА, ржЖржкржирж╛рж░ ржкрзЗрж╢рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи!";
          errorMessage.classList.remove("hidden");
          return;
        }

        if (isNaN(salary) || salary <= 0) {
          errorMessage.innerText = "ржмрж┐ржкрзНрж▓ржмрзА, ржЖржкржирж╛рж░ ржЖржпрж╝рзЗрж░ ржкрж░рж┐ржорж╛ржг ржарж┐ржХржарж╛ржХ ржжрж┐ржи!";
          errorMessage.classList.remove("hidden");
          return;
        }

        const monthlyChada = salary * 0.1;
        const remainingSalary = salary * 0.9;
        const dailyChada = monthlyChada / 30;
        const weeklyChada = dailyChada * 7;
        const yearlyChada = monthlyChada * 12;

        document.getElementById("humor-text").innerText =
          getHumorText(profession);

        const mood = getLeadersMood(monthlyChada);
        document.getElementById("leader-mood-icon").innerHTML = mood.icon;
        document.getElementById("leader-mood-text").innerText = mood.text;

        const contribution = getContributionUse(monthlyChada);
        document.getElementById("contribution-icon").innerHTML =
          contribution.icon;
        document.getElementById("contribution-text").innerText =
          contribution.text;

        const survival = getSurvivalAnalysis(remainingSalary);
        document.getElementById("survival-icon").innerHTML = survival.icon;
        document.getElementById("survival-text").innerText = survival.text;
        document.getElementById("remaining-salary").innerText =
          formatCurrency(remainingSalary);

        const results = [
          { label: "ржжрзИржирж┐ржХ", value: formatCurrency(dailyChada) },
          { label: "рж╕рж╛ржкрзНрждрж╛рж╣рж┐ржХ", value: formatCurrency(weeklyChada) },
          { label: "ржорж╛рж╕рж┐ржХ", value: formatCurrency(monthlyChada) },
          { label: "ржмрж╛рзОрж╕рж░рж┐ржХ", value: formatCurrency(yearlyChada) },
        ];
        const resultDetails = document.getElementById("result-details");
        resultDetails.innerHTML = "";
        results.forEach((item) => {
          const itemDiv = document.createElement("div");
          itemDiv.className = `result-item`;
          itemDiv.innerHTML = `<span>${item.label}:</span><span>${item.value}</span>`;
          resultDetails.appendChild(itemDiv);
        });

        if (chadaChartInstance) chadaChartInstance.destroy();

        const chartCtx = document.getElementById("chadaChart").getContext("2d");
        chadaChartInstance = new Chart(chartCtx, {
          type: "bar",
          data: {
            labels: ["ржжрзИржирж┐ржХ", "рж╕рж╛ржкрзНрждрж╛рж╣рж┐ржХ", "ржорж╛рж╕рж┐ржХ", "ржмрж╛рзОрж╕рж░рж┐ржХ"],
            datasets: [
              {
                label: "ржЪрж╛ржБржжрж╛рж░ ржкрж░рж┐ржорж╛ржг (ржЯрж╛ржХрж╛ржпрж╝)",
                data: [dailyChada, weeklyChada, monthlyChada, yearlyChada],
                backgroundColor: [
                  "rgba(59, 130, 246, 0.5)",
                  "rgba(37, 99, 235, 0.5)",
                  "rgba(29, 78, 216, 0.5)",
                  "rgba(30, 58, 138, 0.5)",
                ],
                borderColor: "#1e40af",
                borderWidth: 2,
                borderRadius: 5,
              },
            ],
          },
          options: {
            scales: { y: { beginAtZero: true } },
            plugins: { legend: { display: false } },
          },
        });

        resultContainer.classList.remove("hidden");
        resultContainer.scrollIntoView({ behavior: "smooth" });
      }

      function generateReceipt() {
        const professionSelect = document.getElementById("profession");
        const selectedProfession =
          professionSelect.options[professionSelect.selectedIndex].text;
        const salary = parseFloat(document.getElementById("salary").value) || 0;
        const monthlyChada = salary * 0.1;
        const remainingSalary = salary * 0.9;
        const today = new Date();
        const dateString = today.toLocaleDateString("bn-BD", {
          day: "2-digit",
          month: "long",
          year: "numeric",
        });

        document.getElementById("receipt-profession").innerText =
          selectedProfession;
        document.getElementById("receipt-chada").innerText =
          formatCurrency(monthlyChada);
        document.getElementById("receipt-remaining").innerText =
          formatCurrency(remainingSalary);
        document.getElementById("receipt-date").innerText = dateString;

        const receiptElement = document.getElementById("receipt-container");
        const modal = document.getElementById("receipt-modal");
        const previewContainer = document.getElementById("receipt-preview");
        const downloadLink = document.getElementById("download-link");

        previewContainer.innerHTML = "<p>рж░рж╕рж┐ржж рждрзИрж░рж┐ рж╣ржЪрзНржЫрзЗ...</p>";
        modal.classList.remove("hidden");
        modal.classList.add("flex");

        html2canvas(receiptElement, {
          scale: 1,
          useCORS: true,
          allowTaint: true,
        }).then((canvas) => {
          const imageUrl = canvas.toDataURL("image/png");
          previewContainer.innerHTML = "";
          const img = document.createElement("img");
          img.src = imageUrl;
          img.className = "max-w-full h-auto";
          previewContainer.appendChild(img);
          downloadLink.href = imageUrl;
        });
      }

      function closeModal() {
        document.getElementById("receipt-modal").classList.add("hidden");
      }

      function generateSpecialReceipt() {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = 800;
        canvas.height = 600;

        const gradient = ctx.createLinearGradient(
          0,
          0,
          canvas.width,
          canvas.height
        );
        gradient.addColorStop(0, "#1f2937");
        gradient.addColorStop(0.5, "#374151");
        gradient.addColorStop(1, "#111827");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.strokeStyle = "#fbbf24";
        ctx.lineWidth = 10;
        ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

        ctx.fillStyle = "#fbbf24";
        ctx.font = "bold 40px 'Tiro Bangla', serif";
        ctx.textAlign = "center";
        ctx.fillText("ЁЯПЫя╕П ржмрж┐рж╢рзЗрж╖ рж╕ржорзНржорж╛ржиржирж╛ рж╕ржиржж ЁЯПЫя╕П", canvas.width / 2, 100);

        ctx.fillStyle = "#ffffff";
        ctx.font = "28px 'Tiro Bangla', serif";
        ctx.fillText("ржЕржмрж╕рж░ржкрзНрж░рж╛ржкрзНржд ржирзЗрждрж╛рж░ ржЬржирзНржп", canvas.width / 2, 150);

        ctx.font = "24px 'Noto Sans Bengali', sans-serif";
        ctx.fillText(
          "ржПржЗ рж╕ржиржжржкрждрзНрж░ ржкрзНрж░ржорж╛ржг ржХрж░рзЗ ржпрзЗ, ржЖржкржирж┐ ржПржХржЬржи",
          canvas.width / 2,
          240
        );

        ctx.fillStyle = "#fbbf24";
        ctx.font = "bold 32px 'Noto Sans Bengali', sans-serif";
        ctx.fillText("рж╕ржорзНржорж╛ржирж┐ржд ржУ ржЕржнрж┐ржЬрзНржЮ рж╕рж╣ржпрзЛржжрзНржзрж╛", canvas.width / 2, 290);

        ctx.fillStyle = "#ffffff";
        ctx.font = "22px 'Noto Sans Bengali', sans-serif";
        ctx.fillText("ржПржмржВ ржмрж┐рж╢рзЗрж╖ рж╕рзБржмрж┐ржзрж╛рж╕ржорзВрж╣рзЗрж░ ржЕржзрж┐ржХрж╛рж░рзАред", canvas.width / 2, 340);

        ctx.font = "80px Arial";
        ctx.fillText("ЁЯдЭ", canvas.width / 2, 420);

        ctx.fillStyle = "#fbbf24";
        ctx.font = "italic 20px 'Noto Sans Bengali', sans-serif";
        ctx.fillText(
          "ржирзМржХрж╛ ржЖрж░ ржзрж╛ржирзЗрж░ рж╢рзАрж╖ ржжрзБржЗ рж╕рж╛ржкрзЗрж░ ржПржХ ржПржХ ржмрж┐рж╖",
          canvas.width / 2,
          480
        );

        const date = new Date().toLocaleDateString("bn-BD");
        ctx.fillStyle = "#9ca3af";
        ctx.font = "16px 'Noto Sans Bengali', sans-serif";
        ctx.fillText("рждрж╛рж░рж┐ржЦ: " + date, canvas.width / 2, 550);

        canvas.toBlob(
          function (blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "ржмрж┐рж╢рзЗрж╖_рж╕ржиржжржкрждрзНрж░.jpg";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          },
          "image/jpeg",
          0.95
        );
      }
    